# deploy_contract.py

import json
from web3 import Web3

# Connect to Ganache
ganache_url = "http://127.0.0.1:7545"
web3 = Web3(Web3.HTTPProvider(ganache_url))

# Check connection
if not web3.is_connected():
    raise Exception("Failed to connect to Ganache!")

# Paste your ABI here (as Python list)
abi = [
    {"anonymous": False, "inputs": [{"indexed": False, "internalType": "uint256", "name": "proposalId", "type": "uint256"}, {"indexed": False, "internalType": "enum DAOCouncil.Decision", "name": "decision", "type": "uint8"}], "name": "Finalized", "type": "event"},
    {"anonymous": False, "inputs": [{"indexed": False, "internalType": "uint256", "name": "proposalId", "type": "uint256"}, {"indexed": False, "internalType": "string", "name": "title", "type": "string"}], "name": "ProposalSubmitted", "type": "event"},
    {"anonymous": False, "inputs": [{"indexed": False, "internalType": "uint256", "name": "proposalId", "type": "uint256"}, {"indexed": False, "internalType": "string", "name": "voter", "type": "string"}, {"indexed": False, "internalType": "bool", "name": "approve", "type": "bool"}], "name": "Voted", "type": "event"},
    {"inputs": [{"internalType": "uint256", "name": "_proposalId", "type": "uint256"}], "name": "finalizeProposal", "outputs": [], "stateMutability": "nonpayable", "type": "function"},
    {"inputs": [{"internalType": "uint256", "name": "_proposalId", "type": "uint256"}], "name": "getProposal", "outputs": [{"components": [{"internalType": "uint256", "name": "id", "type": "uint256"}, {"internalType": "string", "name": "title", "type": "string"}, {"internalType": "string", "name": "description", "type": "string"}, {"internalType": "uint256", "name": "votesApprove", "type": "uint256"}, {"internalType": "uint256", "name": "votesReject", "type": "uint256"}, {"internalType": "enum DAOCouncil.Decision", "name": "finalDecision", "type": "uint8"}], "internalType": "struct DAOCouncil.Proposal", "name": "", "type": "tuple"}], "stateMutability": "view", "type": "function"},
    {"inputs": [], "name": "nextProposalId", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"},
    {"inputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "name": "proposals", "outputs": [{"internalType": "uint256", "name": "id", "type": "uint256"}, {"internalType": "string", "name": "title", "type": "string"}, {"internalType": "string", "name": "description", "type": "string"}, {"internalType": "uint256", "name": "votesApprove", "type": "uint256"}, {"internalType": "uint256", "name": "votesReject", "type": "uint256"}, {"internalType": "enum DAOCouncil.Decision", "name": "finalDecision", "type": "uint8"}], "stateMutability": "view", "type": "function"},
    {"inputs": [{"internalType": "string", "name": "_title", "type": "string"}, {"internalType": "string", "name": "_description", "type": "string"}], "name": "submitProposal", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "nonpayable", "type": "function"},
    {"inputs": [{"internalType": "uint256", "name": "_proposalId", "type": "uint256"}, {"internalType": "string", "name": "_voterName", "type": "string"}, {"internalType": "bool", "name": "_approve", "type": "bool"}], "name": "vote", "outputs": [], "stateMutability": "nonpayable", "type": "function"}
]

# Your compiled bytecode (paste full string starting with 0x)
bytecode = "6080604052600160005534801561001557600080fd5b506111b1806100256000396000f3fe608060405234801561001057600080fd5b50600436106100625760003560e01c8063013cf08b146100675780632ab09d141461009c578063369b0d82146100ba5780635652077c146100d6578063be0dc4b7146100f2578063c7f758a814610122575b600080fd5b610081600480360381019061007c9190610974565b610152565b60405161009396959493929190610ac0565b60405180910390f35b6100a46102ab565b6040516100b19190610b2f565b60405180910390f35b6100d460048036038101906100cf9190610cb7565b6102b1565b005b6100f060048036038101906100eb9190610974565b610409565b005b61010c60048036038101906101079190610d26565b61059e565b6040516101199190610b2f565b60405180910390f35b61013c60048036038101906101379190610974565b610695565b6040516101499190610e96565b60405180910390f35b600160205280600052604060002060009150905080600001549080600101805461017b90610ee7565b80601f01602080910402602001604051908101604052809291908181526020018280546101a790610ee7565b80156101f45780601f106101c9576101008083540402835291602001916101f4565b820191906000526020600020905b8154815290600101906020018083116101d757829003601f168201915b50505050509080600201805461020990610ee7565b80601f016020809104026020016040519081016040528092919081815260200182805461023590610ee7565b80156102825780601f1061025757610100808354040283529160200191610282565b820191906000526020600020905b81548152906001019060200180831161026557829003601f168201915b5050505050908060030154908060040154908060050160009054906101000a900460ff16905086565b60005481565b6000600160008581526020019081526020016000209050600081600001541415610310576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161030790610f65565b60405180910390fd5b6000600281111561032457610323610a49565b5b8160050160009054906101000a900460ff16600281111561034857610347610a49565b5b14610388576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161037f90610fd1565b60405180910390fd5b81156103ad578060030160008154809291906103a390611020565b91905055506103c8565b8060040160008154809291906103c290611020565b91905055505b7fb38f81d11a8b13e8de199f826aa7c921831e71fb500852e9b6118f42ff1e30ac8484846040516103fb93929190611078565b60405180910390a150505050565b6000600160008381526020019081526020016000209050600081600001541415610468576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161045f90610f65565b60405180910390fd5b6000600281111561047c5761047b610a49565b5b8160050160009054906101000a900460ff1660028111156104a05761049f610a49565b5b146104e0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104d790611102565b60405180910390fd5b8060040154816003015411156105225760018160050160006101000a81548160ff0219169083600281111561051857610517610a49565b5b0217905550610550565b60028160050160006101000a81548160ff0219169083600281111561054a57610549610a49565b5b02179055505b7f14b32513bc60303cd54741ac55d1169cbcdcf5a83e16d63a54a082bf3724999f828260050160009054906101000a900460ff16604051610592929190611122565b60405180910390a15050565b600080600160008054815260200190815260200160002090506000548160000181905550838160010190805190602001906105da92919061083f565b50828160020190805190602001906105f392919061083f565b50600081600301819055506000816004018190555060008160050160006101000a81548160ff021916908360028111156106305761062f610a49565b5b02179055507f076921e45db4958d9ff79453aa2f12e0fa9664505544a9f664f8762b330cf7ca6000548560405161066892919061114b565b60405180910390a160008081548092919061068290611020565b9190505550806000015491505092915050565b61069d6108c5565b600160008381526020019081526020016000206040518060c0016040529081600082015481526020016001820180546106d590610ee7565b80601f016020809104026020016040519081016040528092919081815260200182805461070190610ee7565b801561074e5780601f106107235761010080835404028352916020019161074e565b820191906000526020600020905b81548152906001019060200180831161073157829003601f168201915b5050505050815260200160028201805461076790610ee7565b80601f016020809104026020016040519081016040528092919081815260200182805461079390610ee7565b80156107e05780601f106107b5576101008083540402835291602001916107e0565b820191906000526020600020905b8154815290600101906020018083116107c357829003601f168201915b5050505050815260200160038201548152602001600482015481526020016005820160009054906101000a900460ff16600281111561082257610821610a49565b5b600281111561083457610833610a49565b5b815250509050919050565b82805461084b90610ee7565b90600052602060002090601f01602090048101928261086d57600085556108b4565b82601f1061088657805160ff19168380011785556108b4565b828001600101855582156108b4579182015b828111156108b3578251825591602001919060010190610898565b5b5090506108c1919061090d565b5090565b6040518060c0016040528060008152602001606081526020016060815260200160008152602001600081526020016000600281111561090757610906610a49565b5b81525090565b5b8082111561092657600081600090555060010161090e565b5090565b6000604051905090565b600080fd5b600080fd5b6000819050919050565b6109518161093e565b811461095c57600080fd5b50565b60008135905061096e81610948565b92915050565b60006020828403121561098a57610989610934565b5b60006109988482850161095f565b91505092915050565b6109aa8161093e565b82525050565b600081519050919050565b600082825260208201905092915050565b60005b838110156109ea5780820151818401526020810190506109cf565b838111156109f9576000848401525b50505050565b6000601f19601f8301169050919050565b6000610a1b826109b0565b610a2581856109bb565b9350610a358185602086016109cc565b610a3e816109ff565b840191505092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b60038110610a8957610a88610a49565b5b50565b6000819050610a9a82610a78565b919050565b6000610aaa82610a8c565b9050919050565b610aba81610a9f565b82525050565b600060c082019050610ad560008301896109a1565b8181036020830152610ae78188610a10565b90508181036040830152610afb8187610a10565b9050610b0a60608301866109a1565b610b1760808301856109a1565b610b2460a0830184610ab1565b979650505050505050565b6000602082019050610b4460008301846109a1565b92915050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610b8c826109ff565b810181811067ffffffffffffffff82111715610bab57610baa610b54565b5b80604052505050565b6000610bbe61092a565b9050610bca8282610b83565b919050565b600067ffffffffffffffff821115610bea57610be9610b54565b5b610bf3826109ff565b9050602081019050919050565b82818337600083830152505050565b6000610c22610c1d84610bcf565b610bb4565b905082815260208101848484011115610c3e57610c3d610b4f565b5b610c49848285610c00565b509392505050565b600082601f830112610c6657610c65610b4a565b5b8135610c76848260208601610c0f565b91505092915050565b60008115159050919050565b610c9481610c7f565b8114610c9f57600080fd5b50565b600081359050610cb181610c8b565b92915050565b600080600060608486031215610cd057610ccf610934565b5b6000610cde8682870161095f565b935050602084013567ffffffffffffffff811115610cff57610cfe610939565b5b610d0b86828701610c51565b9250506040610d1c86828701610ca2565b9150509250925092565b60008060408385031215610d3d57610d3c610934565b5b600083013567ffffffffffffffff811115610d5b57610d5a610939565b5b610d6785828601610c51565b925050602083013567ffffffffffffffff811115610d8857610d87610939565b5b610d9485828601610c51565b9150509250929050565b610da78161093e565b82525050565b600082825260208201905092915050565b6000610dc9826109b0565b610dd38185610dad565b9350610de38185602086016109cc565b610dec816109ff565b840191505092915050565b610e0081610a9f565b82525050565b600060c083016000830151610e1e6000860182610d9e565b5060208301518482036020860152610e368282610dbe565b91505060408301518482036040860152610e508282610dbe565b9150506060830151610e656060860182610d9e565b506080830151610e786080860182610d9e565b5060a0830151610e8b60a0860182610df7565b508091505092915050565b60006020820190508181036000830152610eb08184610e06565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610eff57607f821691505b60208210811415610f1357610f12610eb8565b5b50919050565b7f50726f706f73616c206e6f7420666f756e640000000000000000000000000000600082015250565b6000610f4f6012836109bb565b9150610f5a82610f19565b602082019050919050565b60006020820190508181036000830152610f7e81610f42565b9050919050565b7f50726f706f73616c20616c72656164792066696e616c697a6564000000000000600082015250565b6000610fbb601a836109bb565b9150610fc682610f85565b602082019050919050565b60006020820190508181036000830152610fea81610fae565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061102b8261093e565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82141561105e5761105d610ff1565b5b600182019050919050565b61107281610c7f565b82525050565b600060608201905061108d60008301866109a1565b818103602083015261109f8185610a10565b90506110ae6040830184611069565b949350505050565b7f416c72656164792066696e616c697a6564000000000000000000000000000000600082015250565b60006110ec6011836109bb565b91506110f7826110b6565b602082019050919050565b6000602082019050818103600083015261111b816110df565b9050919050565b600060408201905061113760008301856109a1565b6111446020830184610ab1565b9392505050565b600060408201905061116060008301856109a1565b81810360208301526111728184610a10565b9050939250505056fea2646970667358221220c91e9dbe47ad5a1439661df5ee97bd283fd953783853b04b7913fecf8c4c452f64736f6c63430008090033"   # (paste your full bytecode here)

# Set the default account
web3.eth.default_account = web3.eth.accounts[0]

# Create contract instance
DAOCouncil = web3.eth.contract(abi=abi, bytecode=bytecode)

# Deploy
tx_hash = DAOCouncil.constructor().transact()

# Wait for deployment to finish
tx_receipt = web3.eth.wait_for_transaction_receipt(tx_hash)

print(f"✅ Contract deployed successfully at address: {tx_receipt.contractAddress}")
